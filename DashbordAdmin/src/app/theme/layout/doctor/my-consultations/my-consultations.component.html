<div class="consultation-wrapper">

  <div class="header">
    <h2><i class="bx bx-health"></i> Mes Consultations</h2>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Chargement...</span>
    </div>
    <p class="mt-2">Chargement des consultations...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="alert alert-danger" role="alert">
    {{ error }}
    <button class="btn btn-link" (click)="loadConsultations()">Réessayer</button>
  </div>

  <div *ngIf="!loading && !error">
    <div class="filters">
      <div class="field">
        <i class="bx bx-user"></i>
        <input type="text" placeholder="Rechercher patient..." [formControl]="patientControl" (input)="applyFilter()">
      </div>

      <div class="field">
        <i class="bx bx-calendar"></i>
        <input type="date" [formControl]="dateControl" (change)="applyFilter()">
      </div>

      <div class="field">
        <i class="bx bx-check-circle"></i>
        <select [formControl]="statutControl" (change)="applyFilter()">
          <option value="">Tous les statuts</option>
          <option value="Confirmé">Confirmé</option>
          <option value="En attente">En attente</option>
          <option value="Annulé">Annulé</option>
          <option value="Terminé">Terminé</option>
        </select>
      </div>

      <button class="btn btn-sm btn-secondary" (click)="resetFilter()">Réinitialiser</button>
    </div>

    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>Patient</th>
            <th>Date</th>
            <th>Heure</th>
            <th>Motif</th>
            <th>Statut</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let c of filteredConsultations">
            <td>{{ c.patient_nom }}</td>
            <td>{{ c.date }}</td>
            <td>{{ c.heure }}</td>
            <td>{{ c.motif || 'Non spécifié' }}</td>
            <td>
              <span [class]="getStatusClass(c.statut)">{{ c.statut }}</span>
            </td>
          </tr>
          <tr *ngIf="filteredConsultations.length === 0">
            <td colspan="5" class="text-center text-muted">Aucune consultation trouvée</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="mt-3 text-muted">
      Total: {{ filteredConsultations.length }} consultation(s)
    </div>
  </div>
</div>
