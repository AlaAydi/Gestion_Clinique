<div class="profile-container">
  <!-- Loading State -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Chargement...</span>
    </div>
    <p class="mt-2">Chargement du profil...</p>
  </div>

  <!-- Error Alert -->
  <div *ngIf="error" class="alert alert-danger" role="alert">
    {{ error }}
  </div>

  <!-- Success Alert -->
  <div *ngIf="successMessage" class="alert alert-success" role="alert">
    {{ successMessage }}
  </div>

  <!-- Tabs -->
  <div class="tabs-container" *ngIf="!loading">
    <button class="tab-btn" [class.active]="activeTab === 'profile'" (click)="setActiveTab('profile')">
      <i class="fa fa-user"></i> Profil
    </button>
    <button class="tab-btn" [class.active]="activeTab === 'password'" (click)="setActiveTab('password')">
      <i class="fa fa-lock"></i> Mot de passe
    </button>
  </div>

  <!-- Profile Tab -->
  <form *ngIf="!loading && activeTab === 'profile'" [formGroup]="profileForm" (ngSubmit)="saveProfile()">

    <div class="header-card">
      <div class="profile-pic">
        <img [src]="getImageUrl()" alt="Doctor Avatar" />
        <input type="file" id="imageUpload" accept="image/*" (change)="onImageSelected($event)" style="display: none;">
        <label for="imageUpload" class="btn btn-sm btn-outline-primary mt-2" style="cursor: pointer;">
          Changer la photo
        </label>
      </div>
      <div class="header-info">
        <h2>Dr. {{ profileForm.get('prenom')?.value || 'Docteur' }} {{ profileForm.get('nom')?.value }}</h2>
        <span class="speciality">{{ profileForm.get('specialty')?.value }}</span>
      </div>
    </div>

    <div class="form-grid">
      <div class="card">
        <h3>Informations Personnelles</h3>
        <div class="form-group">
          <label>Prenom *</label>
          <input formControlName="prenom" type="text" placeholder="Prenom du medecin" />
        </div>
        <div class="form-group">
          <label>Nom *</label>
          <input formControlName="nom" type="text" placeholder="Nom du medecin" />
        </div>
        <div class="form-group">
          <label>Email</label>
          <input formControlName="email" type="email" placeholder="Email professionnel" />
        </div>
        <div class="form-group">
          <label>Telephone</label>
          <input formControlName="phone" type="text" placeholder="Telephone" />
        </div>
      </div>

      <div class="card">
        <h3>Informations Professionnelles</h3>
        <div class="form-group">
          <label>Specialite *</label>
          <input formControlName="specialty" type="text" placeholder="Ex: Cardiologue" />
        </div>
        <div class="form-group">
          <label>Horaires de travail</label>
          <input formControlName="schedule" type="text" placeholder="Ex: Lun-Ven 9h-17h" />
        </div>
      </div>
    </div>

    <div class="submit-container">
      <button type="submit" class="btn-submit" [disabled]="profileForm.invalid || saving">
        <span *ngIf="saving">Enregistrement...</span>
        <span *ngIf="!saving">Enregistrer</span>
      </button>
    </div>
  </form>

  <!-- Password Tab -->
  <div class="password-container" *ngIf="!loading && activeTab === 'password'">
    <div class="card password-card">
      <h3>Changer le mot de passe</h3>
      <form [formGroup]="passwordForm" (ngSubmit)="onChangePassword()">
        <div class="form-group">
          <label>Mot de passe actuel *</label>
          <input type="password" formControlName="current_password" placeholder="********" />
        </div>
        <div class="form-group">
          <label>Nouveau mot de passe *</label>
          <input type="password" formControlName="new_password" placeholder="********" />
          <small>Minimum 6 caracteres</small>
        </div>
        <div class="form-group">
          <label>Confirmer le mot de passe *</label>
          <input type="password" formControlName="confirm_password" placeholder="********" />
        </div>
        <div class="submit-container">
          <button type="submit" class="btn-submit" [disabled]="changingPassword || !passwordForm.valid">
            {{ changingPassword ? 'Modification...' : 'Modifier le mot de passe' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
