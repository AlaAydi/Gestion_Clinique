<div class="calendar-container">
  <!-- Loading State -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Chargement...</span>
    </div>
    <p class="mt-2">Chargement du calendrier...</p>
  </div>

  <div *ngIf="error" class="alert alert-danger" role="alert">
    {{ error }}
    <button class="btn btn-link" (click)="loadCalendarData()">Réessayer</button>
  </div>

  <div *ngIf="!loading && !error">
    <full-calendar [options]="calendarOptions"></full-calendar>

    <div class="legend mt-3 d-flex gap-3 flex-wrap">
      <span class="badge" style="background-color: #28a745;">Confirmé</span>
      <span class="badge" style="background-color: #ffc107; color: #000;">En attente</span>
      <span class="badge" style="background-color: #dc3545;">Annulé</span>
      <span class="badge" style="background-color: #17a2b8;">Terminé</span>
    </div>
  </div>

  <div class="modal-backdrop" *ngIf="showModal">
    <div class="modal-box">

      <h2 class="modal-title">Détails de la Consultation</h2>

      <div class="info-line">
        <span class="label">Patient :</span>
        <span class="value">{{ selectedEvent?.patient }}</span>
      </div>

      <div class="info-line">
        <span class="label">Téléphone :</span>
        <span class="value">{{ selectedEvent?.phone || 'Non renseigné' }}</span>
      </div>

      <div class="info-line">
        <span class="label">Email :</span>
        <span class="value">{{ selectedEvent?.email || 'Non renseigné' }}</span>
      </div>

      <div class="info-line">
        <span class="label">Statut :</span>
        <span class="value">
          <span class="badge" [style.background-color]="getStatusColor(selectedEvent?.statut)">
            {{ selectedEvent?.statut }}
          </span>
        </span>
      </div>

      <div class="info-block">
        <h3>Motif de la consultation</h3>
        <p>{{ selectedEvent?.remark || 'Aucun motif spécifié' }}</p>
      </div>

      <div class="info-block" *ngIf="patientHistory.length > 0">
        <h3>Historique du patient ({{ patientHistory.length }} consultation(s) précédente(s))</h3>
        <div class="history-item" *ngFor="let h of patientHistory">
          <p>
            <strong>{{ h.date }}</strong> - {{ h.remark || 'Aucun motif' }}
            <span class="badge" [style.background-color]="getStatusColor(h.statut)" style="margin-left: 5px;">
              {{ h.statut }}
            </span>
          </p>
        </div>
      </div>

      <button class="modern-btn neutral" (click)="closeModal()">Fermer</button>
    </div>
  </div>
</div>
